{"total":13,"pageSize":10,"pageCount":2,"data":[{"title":"深度: 关于Libra2.0的新思路与新思考（叁）","slug":"深度-关于Libra2-0的新思路与新思考（叁）","date":"2022-01-09T05:58:49.000Z","updated":"2022-01-09T05:58:49.843Z","comments":true,"path":"api/articles/深度-关于Libra2-0的新思路与新思考（叁）.json","excerpt":"字都是笔者一个一个码的，续前两篇：《 关于 Libra2.0 的新思路与新思考（壹）》《 关于 Libra2.0 的新思路与新思考（贰）》（二）建立健壮的监管服从框架来增强 Libra 支...","keywords":["blockchain","crypto","darwinia","dcep","meta","socialfi","xcarnival"],"cover":null,"content":"<p>字都是笔者一个一个码的，续前两篇：</p>\n<p>《 <a href=\"http://mp.weixin.qq.com/s?__biz=MzU5NTcxMTA2Mw==&amp;mid=2247484041&amp;idx=1&amp;sn=f808e07fcff08e7c367fe90545ff39cf&amp;chksm=fe6c87b1c91b0ea702044dafc06a7903911e5817aba47cc08d8ecf235f4321fadada15b84503&amp;scene=21#wechat_redirect\">关于 Libra2.0 的新思路与新思考（壹）</a>》</p>\n<p><a href=\"http://mp.weixin.qq.com/s?__biz=MzU5NTcxMTA2Mw==&amp;mid=2247484047&amp;idx=1&amp;sn=1d744f2fb967b39f3fb9fd76948e038d&amp;chksm=fe6c87b7c91b0ea132fbcf01d03d85dbe55a58098480ab8cc4aa0f373141cf417a176ae76385&amp;scene=21#wechat_redirect\">《 关于 Libra2.0 的新思路与新思考（贰）》</a></p>\n<p>（二）<strong>建立健壮的监管服从框架来增强Libra 支付系统的安全性</strong></p>\n<p>基于当前项目发展的需求和市场监管的压力，Libra 协会正考虑一种调和的目标，一方面能够保证 Libra 项目的发展符合法律和监管要求，同时又能符合项目开放性的金融化目标（目前央行 DCEP 落地在即，Libra 作为西方世界数字货币的潜在可行性项目，经常拿出来跟 DCEP 进行比较，但两者从架构到参与方到运营模式，都是完全不一样的东西，总体而言 Libra 的野心更大一些，其想要一开始就建立世界网络并形成数字货币新秩序，而 DCEP 的路线就更扎实些，先铺国内及应用场景，再考虑应用于国际汇兑结算网络）。符合监管要求，接受监管，也就是意味着能够为 Libra 支付网络的使用者提供更多的安全性保障，目前协会已经与监管方（主要是瑞士方面和美国方面）建立了审慎的金融监管机制，以符合 AML 反洗钱、CFT 反恐怖融资以及避免其他违法应用场景的监管要求。这里面包括建立金融情报的功能机制 FIU 来支撑和维护 Libra 网络参与者的资质门槛。</p>\n<p>Libra 网络中有四类参与者：1、指定的经销商；2、虚拟资产服务提供商 VASP，包括交易所和托管类钱包，这些 VASP 都需要在 FATF（反洗钱金融行动特别工作组，是西方七国专门成立的，目前世界上最有影响力的 AML 和 CFT 国际组织，2007 年中国成为 FATF 正式成员）成员的管辖区域内获得注册及许可经营证书；3、被 Libra 协会审核并获得 Libra 协会认证的 VASP（第二条是获得 FATF 认证的 VASP）；4、非托管类钱包。非托管类钱包可以促进金融整合、更广泛的竞争，促成合理的金融创新并为没有银行账户或者享受金融服务不足的地区和个人提供便利服务。（所谓托管类钱包就是用户的私钥保存在网络服务器上，钱包服务商在特定情况下可以对用户的资产进行操控，这就存在中心化的风险，存在被黑客攻击的可能；而非托管类钱包是用户私钥由用户保管，服务器提供功能有限，这种去中心化的方式能够保障用户的数字资产安全性，但私钥一旦丢失，资产将无法找回）。非托管类钱包由于其潜在的风险性，其资金体量和转账都会存在限制。Libra 网络的运作初期，网络参与者将只有指定的经销商和 FATF 认证的 VASP，随着 Libra 协会不断优化其自身的认证制度并形成非托管钱包的管理框架，后两种参与者最终也将参与到网络中来。（从这点看，在相当长时间内，Libra 的参与方将符合强监管特性，从这点可以充分看出 Libra 对监管的迎合）。</p>\n<p>1、<strong>Libra 网络参与者与其角色</strong></p>\n<p>（1）<strong>Libra 协会及其分支机构</strong></p>\n<p>负责Libra 结算网络的治理及 Libra 项目的发展；</p>\n<p>对协会成员、指定的经销商及验证节点进行尽调；</p>\n<p>控制Libra 链上代币的发行和销毁；</p>\n<p>为Libra 网络的参与者制定运行标准，并落实协议和其他的监管控制要求；</p>\n<p>实施FIU 功能（金融情报功能）模块来监测网络的可疑活动。</p>\n<p>（2）<strong>协会成员</strong></p>\n<p>参与协会治理；</p>\n<p>接受协会定期的尽调监督。</p>\n<p>（3）<strong>指定的经销商</strong></p>\n<p>在Libra 网络中购买和出售 Libra 代币；</p>\n<p>通过交易所或者OTC 交易商买卖 Libra 代币，为代币最终使用者提供流动性媒介；</p>\n<p>接受协会定期尽调，应当有足够的资金实力并且在外汇市场交易方面有足够的专业性。</p>\n<p><strong>（4）虚拟资产服务提供商 VASP</strong></p>\n<p>关于VASP 的定义出自 2019 年 FATF 对于虚拟资产和虚拟资产服务提供商的指南中；</p>\n<p>为Libra 网络上的客户提供交易所、托管及其他相关金融服务；</p>\n<p>部分VASP 在 Libra 网络上的运营没有交易和持仓总额数量限制，这些 VASP 是严格遵从监管要求的，并且定期接受协会或者其分支机构的尽调监督。另外，符合协会或其分支机构资质要求的 VASP 也可以在网络上提供服务。（后期网络成熟且稳定后，这种被协会所认证的 VASP 才可以正常提供服务，但协会可以依据这些 VASP 成员的监管服从程度及安全性，设定不同的交易和持仓总额限制，这些对当前的 Libra 项目来说，都是未知之数。）</p>\n<p><strong>（5）非托管类钱包</strong></p>\n<p>指的是Libra 区块链网络上的普通地址，与上面提到的各类参与者相区别；</p>\n<p>这些地址会受到限制，这些地址间的交易以及持仓数量都会受到限制，这些限制会在协议层面上设定并实现。（所谓非托管钱包，可以简单理解为Libra 网络上众多匿名的私有地址，这些地址私钥由个人保存，而非进行集中化托管，因此匿名性较强，监管度较弱，因此网络会对此类地址的交易和持仓进行限制，以防范监管风险。）</p>\n<p>2、<strong>监管和安全控制的细节</strong></p>\n<p><strong>（1）Libra 协会将会形成健全的监管体制</strong></p>\n<p>Libra 协会将会健全监管服从机制来符合相关法律规章的要求，这种监管服从机制将至少包括以下几个方面：</p>\n<p>设置CCO 首席合规官；</p>\n<p>设置合规委员会并定期制定监测报告；</p>\n<p>制定AML/CFT 政策及程序以开展风险评估，这些政策和程序必须经过 Libra 协会或其分支机构的董事会通过；</p>\n<p>对上文提到的参与者进行尽调；</p>\n<p>定期修订监管政策以保障制度的适当性并随着依据外部监管变化而调整；</p>\n<p>创建FIU 金融情报功能来对链上可疑违法活动进行检测；</p>\n<p>定期开展内部审计；</p>\n<p>对相关成员或职员进行培训教育。</p>\n<p>（2）<strong>协会将会为Libra 支付系统的使用设定刚性标准</strong></p>\n<p>协会将会对所有网络上的参与者，包括协会成员、指定的经销商、VASP 等，设定刚性的准入和合规标准。只要符合这些标准，相关参与者将无限制的可以开展链上活动，或者说相对于弱监管的、独立的钱包地址（非托管类钱包）受到更少的限制。</p>\n<p>（3）<strong>协会将会对协会成员和指定经销商开展尽调</strong></p>\n<p>协会的尽调工作将会在参与者真正开展链上活动之前，即获得准入资格前。这些尽调至少要满足协会本身设定的要求，来保障Libra 网络参与者的集体高标准、高合规性及高可信度。这些尽调具体包括但不限于以下内容：</p>\n<p>经营状态、监管处罚历史、负面新闻、受益方及实控人、AML/CFT 及处罚的相关要求、注册及资格证颁发、经营处所及客户群。</p>\n<p>通过尽调，协会能够保证所有的经销商都能够符合资本及外汇交易专业度的要求，同时相关符合资质的经销商又可以对其下游的交易对手方开展尽调。</p>\n<p>协会不仅会对即将加入Libra 网络的参与方开展尽调，同时，对于已经获得准入资格并开展了链上活动的参与方，协会也将定期开展“回头看”式的尽调检查。</p>\n<p>（4）<strong>协会将会通过符合监管要求的指定经销商流通代币</strong></p>\n<p>Libra 网络铸造和回收代币都将通过指定的经销商进行，这些经销商会具备足够的资金实力并符合监管要求。（我实在可以理解 Libra 协会对外部监管压力的态度，Libra2.0 白皮书的核心就是服从监管，所以对于监管字样几乎在文章中无处不在，前期 TON 就因为监管问题而流产，Libra 能否在牢笼中脱生，还是个未知数。）Libra 协会是不会直接与交易所及底层用户产生合约关系，而只会通过指定经销商开展链下活动。（对于突发事件或紧急情况，Libra 协会将可能会与交易所和底层用户产生互动，但这种互动往往是应急性的，权利也是单方面的。）</p>\n<p>（5）<strong>只有符合要求的VASP 才会被允许无限制的链上运作</strong></p>\n<p>协会预计绝大多数的Libra 网络参与者都会通过 VASP 开展活动。这些 VASP 将为自己的用户提供交易服务，并可能会形成内部的交易账本，而并非将这些交易全部记录在 Libra 的链上。（这方面的意思可能是 Libra 协会允许 VASP 开展自己的独立链作为 Libra 区块链的侧链或者说平行链，这些链上数据是独立的，链上数据的阶段性结果会打包传输并记录在 Libra 区块链上。或者说 VASP 干脆采用中心化的数据库模式来记录自己的用户信息。）</p>\n<p><strong>Regulated VASP</strong></p>\n<p>被监管的VASP，我理解就是 FATF VASP，此类 VASP 符合 FATF 的相关成员要求。想成为 FATF VASP，需要向 Libra 协会提交请求，包括以下材料：</p>\n<p>在 FATF 成员管辖范围内的许可证或注册证明，这些证明允许其从事VASP 的工作；</p>\n<p>提供主体已经获得所在国家或地区从事相关VASP 活动的法律许可资料；</p>\n<p>论证主体相关基于风险的监管合规计划和控制措施是否合理。</p>\n<p>基于上述的验证以及协会或独立第三方的尽调活动，成功通过的VASP 主体能够获得 Libra 网络上的 Regulated VASP 地址，此类地址能够保障 VASP 能够正常开展经营活动，并不受交易和持仓总量的限制。但特殊情况下，协会可能依然会考虑对此类 VASP 基于其风险情况设置一定的限制。</p>\n<p>协会会定期记录和发布Regulated VASP 的名录及其状态。Regulated VASP 的有效期为一年，到期后必须重新获取资格。协会及独立的第三方也会对这些 VASP 开展动态监测活动。</p>\n<p><strong>Certified VASP</strong></p>\n<p>（这种Certified VASP 与上面 Regulated VASP 是有区别的，Certified VASP 是 Libra 网络发展到后期的产物，网络运营稳定并经过监管验证后，协会本身也可以颁发链上可运营的 VASP 资格，实际上此时外部监管已经对 Libra 网络具备了一定程度的信任。）Certified VASP 是对 Regulated VASP 的一种补充，对于受 FATF 成员管辖但又没有相关 VASP 监管制度的区域，以及非 FATF 成员的管辖区域，这些符合 Libra 协会制定的标准的经营主体可以作为 VASP 开展链上活动，不用跟非托管类钱包受同样的活动限制。值得注意的是，任何在 FATF 成员国管辖的、且有相关 VASP 管理制度的区域内的主体，只能通过成为 Regulated VASP 的方式参与到网络中来，不能申请成为 Certified VASP。</p>\n<p>Certified VASP 的认证也会有不同的标准，最高的标准与 FATF 的标准一致，符合此类标准的 Certified VASP 将不会受到经营限制。同时也会有相对弱的 Certified VASP 标准，符合这些标准的 VASP，虽可以开展经营活动，但会有相应的限制。</p>\n<p>同样的，协会也会定期发布Certified VASP 的名录及其经营状态，Certified VASP 的有效期也为一年，到期后必须重新申请资格，也会受到协会及独立第三方审计机构的动态监测。</p>\n<p><strong>Unhosted Wallet</strong></p>\n<p>用户在使用非托管类钱包，即私人地址时会存在交易的限制以及地址持仓上限的限制。Libra 协会认为允许用户通过非 VASP 的方式与 Libra 网络进行交互操作是非常重要的，通过这种方式能够促进金融包容性，并能够拓展 Libra 网络的使用范围，进而增强改革与竞争。（语言太官方了，笔者理解 Libra 网络要想成功，必须拓宽其使用范围，增加受众群体，否则很难在当前稳定币林立的数字货币领域赢得一席之地，因此允许私人或者集体拥有非托管性的地址，纵使进行合理的限制，也能够拓宽使用群体，特别对于金融深化不足的贫瘠地区，允许使用 Libra 私人地址是非常必要的，这与 Libra 的成立初衷是相一致的。）</p>\n<p>关于促进金融包容性：协会的目标是在现有监管框架下提供最大的金融包容性。这里所谓的金融包容性，就是Libra 网络能够惠及全球银行金融体系不发达地区的人群，并且他们没法接触到 VASP，因为为他们提供金融服务的商业利益前景并不高。通过允许非托管钱包的使用，能够让这部人群可以享受 Libra 网络这种安全、低成本和便捷的金融支付服务。目前，全球即使约 10 亿人拥有手机，约 5 亿人能够上网，仍有 17 亿的人口无法通过传统银行获取金融服务。（举个例子，在非洲大陆的很多地区的人是没有银行账户且无法享受金融服务的，在其他国度打工的非洲人仅能够通过使用 Bitcoin 购买礼品卡的形式将赚的钱转给自己的家人，而这种方式往往具备极高的中间成本。Libra 网络的实现可能会极大的改变这种现状，为此类人群提供相对便利且低成本的金融支付服务。）</p>\n<p>关于促进改革与竞争：通过非托管类钱包，Libra 网络可以为其软件开发者提供內置安全特性的开发平台，这些特性包括合约层面的制裁筛查，合规性的基础设施等（例如 FIU 功能），这些都能够增强 Libra 网络的革新性与竞争性。</p>\n<p>非托管类钱包同时也保障人们能够获得使用创新性智能合约产品的入口，智能合约能够使得参与者基于更复杂、更有创新性的底层逻辑开展合作。（就像在以太坊网络上，智能合约的出现以及图灵完备的智能合约语言可以将商业合作理念完全转化为链上代码，而链上代码的执行是不可篡改的，这就进一步增强合作的可信度。）有了智能合约，除了Libra 网络的核心功能，其他功能也能够在监管框架下被允许开发。</p>\n<p>当然，非托管钱包是有交易限制以及持仓总量限制的，如果想突破这些限制，非托管钱包就必须与VASP 进行合作。当然可以预想的是，部分人肯定会尝试通过使用多个非托管钱包的方式来突破当前对单个钱包的限制，这种行为会被网络的 FIU 功能监测并制止。</p>\n<p>（6）<strong>自动化、协议级的监管控制将会应用于全部链上活动</strong></p>\n<p>协会将会直接在Libra 协议上部署合规控制，这些控制措施能够确保 Libra 区块链上的所有交易都能够符合监管要求。其中一些措施如下：</p>\n<p>被制裁的地址：协议会自动终止那些包含被制裁地址的交易，同时，被制裁地址上的代币存储数量也会被控制；</p>\n<p>被制裁的管辖区：协议会自动终止那些被制裁区域的IP 地址发送的交易；</p>\n<p>非托管类钱包的限制：交易及持仓总量限制；</p>\n<p>VASP 资质认证：协议会自动更新关于 VASP 资质认证的相关信息；</p>\n<p>Travel Rule:Libra 协议将会要求已经准入的 VASP 在提供交易服务时服从 FATF 的 Travel Rule 原则。（什么是 Travel Rule？详细的解释请参考下节）</p>\n<p>（7）<strong>协会将开发链下Travel Rule 协议</strong></p>\n<p>协会将会开发链下协议来帮助VASP 服从 FATF 的 Travel Rule 规则。这个链下协议帮助交易所记录 Libra 网络中参与方的信息，包含开放文本区域来分享补充性的信息。非托管钱包也可以使用这个链下协议来向 VASP 提交必要的数据。（Travel Rule 是 FATF 提出的数字货币资产监管要求，具体而言是要求交易所、托管方、货币基金等涉及交易环节的 VASP 机构在互相转账时需要附上相应的客户信息，从而形成资产的流向图，以便监管机构可追踪。这项规定实质上是与区块链去中心化、匿名化的特征相违背的。）</p>\n<p>（8）<strong>协会的FIU 功能将会监督链上活动</strong></p>\n<p>协会设立金融情报FIU 功能的目的是进行 Libra 支付系统的高标准合规性监测，FIU 功能将会监测链上活动并与各国政府或服务提供商一道来制止违法的链上行为。</p>\n<p>（9）<strong>协会将会对已识别的可疑链上活动及时报告</strong></p>\n<p>链上的可疑活动被FIU 功能监测并识别时，相关的 Libra 区块链地址及证据将会依法被提供给相关监管方或参与方。为了阻止可疑活动，FIU 功能将及时提醒 VASP 哪些非托管钱包地址存在违规的行为。</p>\n<p>（未完待续，敬请期待。。。。。）</p>\n","raw":null,"categories":[],"tags":[]},{"title":"浅析跨链桥（综述）","slug":"浅析跨链桥（综述）","date":"2022-01-09T05:49:06.000Z","updated":"2022-01-09T05:49:06.646Z","comments":true,"path":"api/articles/浅析跨链桥（综述）.json","excerpt":"行文不易，转载请注明出处。（公众号：刘言不蜚语）一、写在前面区块链行业的发展是螺旋式上升的过程，随着行业生态的不断完善以及区块链应用场景的持续延伸，资本和市场的需求会倒逼区块链技术本身的...","keywords":["blockchain","crypto","darwinia","dcep","meta","socialfi","xcarnival"],"cover":"https://storageapi.fleek.co/andoroyur-team-bucket/metanetwork/users/metaio-storage/640-.-webp.jpg","content":"<p><strong>行文不易，转载请注明出处。</strong></p>\n<p><strong>（公众号：刘言不蜚语）</strong></p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmaJVBkbdumtQA1ihv31jAaeUQixRCjPHs9j8yS5L5mxsv\" alt=\"2404b459-f60a-432b-9c81-364b37cdb73d\"></p>\n<p><strong>一、写在前面</strong></p>\n<p>区块链行业的发展是螺旋式上升的过程，随着行业生态的不断完善以及区块链应用场景的持续延伸，资本和市场的需求会倒逼区块链技术本身的自我革新和发展，跨链桥技术也是因此而诞生的。所谓跨链桥，就是不同区块链之间进行信息通信的技术安排，通过中心化或去中心化的方式，实现源链对目标链的信息传递，进而实现资产转移和信息交互。跨链桥技术的出现，是对区块链信息系统的升维操作，如果将单一区块链比作一维直线，跨链桥技术则打破了一维信息孤岛，将区块链带入到三维立体世界。</p>\n<p><strong>二、为什么需要跨链桥</strong></p>\n<p><strong>（一）提高加密资产的应用场景</strong></p>\n<p>现阶段区块链加密资产价值持续走高，金融应用场景不断革新，逐渐赢得了传统行业和主流民众的认可，今年以来，诸如 Defi1.0、Defi2.0、NFT 和 Gamefi 等革新玩法，大大提高了不同区块链项目原生资产的跨链需求，对加密资产的生息和盈利需求大大助推了跨链桥技术的发展。</p>\n<p><strong>（二）区块链生态的外部性拓展</strong></p>\n<p>诸如 Solana、Fantom 这些新兴爆发的公链而言，其链上资产和优质项目有限，如果想引爆项目生态，提升参与度并吸引资金入场，就必须引入现有成熟的诸如以太坊、BSC 链上的聪明资金。通过构建高效的跨链桥，可以实现区块链生态的链外拓展，这也是大多数公链项目均积极筹备建设自有跨链桥的原因。</p>\n<p><strong>（三）应对监管挑战的可行性方案</strong></p>\n<p>随着不同国家对加密货币行业监管的日趋严格，部分国家和地区的居民由于 CEX 的使用限制，使得通过 CEX 进行充值和提现的中心化资产跨链方式应用受限，因此，构建去中心化的，无需 KYC 认证的跨链桥，能够让更多用户便利的进行资产跨链和加密资产应用。</p>\n<p><strong>三、加密资产的跨链安排</strong></p>\n<p>由于当前跨链桥应用场景主要以资产（Token）跨链为主，因此在后面的行文中主要围绕加密资产的跨链进行阐述。本部分我们脱离跨链桥技术本身，基于 YFI 的创始人 Andre Cronje 对跨链资产的分类法，简要阐述四种加密资产的跨链安排方法（假设跨链比例为 1:1，例如以太坊锁定 1 枚 USDT，跨链后，在 BSC 上获得 1 枚 USDT）。</p>\n<p><strong>（一）Balance float（余额调整）</strong></p>\n<p>此类方法是指先在跨链的目标链上铸造足额的 Token 形成一个余额流动性池（Balance float），跨链开始后，每在源区块链锁定 1 枚 Token，则在目标链中从 Balance float 转出 1 枚 Token 至目标地址。由于需要提前 mint 出目标链的流动性池，因此流动性池的安全性就显得尤为重要，同时用户也会面临项目方超发货币的风险。</p>\n<p><strong>（二）Mint/Burn（铸造/销毁）</strong></p>\n<p>即每在源区块链上销毁 1 枚 Token，即在目标链上铸造 1 枚 Token，这种模式可以保证 Token 总供给量的固定，不会出现代币超发突破代币总数的问题。当然，这种模式也可以结合第一种流动性池（Balance float）的方法，当源区块链流动性池中转入 1 枚 Token 时，就在目标链铸造一枚 Token。此类铸造/销毁的方法，是当前区块链中应用最为广泛也是最简单的跨链安排方式。</p>\n<p><strong>（三）Liquidity swap（流动性互换）</strong></p>\n<p>此类方法主要强调使用一种封装资产（Wrapped Token）作为跨链的中间资产，当进行资产跨链时，首先在目标链生成封装资产，而后使用流动性池将封装资产与非封装资产进行互换。（例如将 1USDC 从以太坊跨链至 FTM，首先使用 anyswap 得到封装代币 anyUSDC，而后提供 USDC-anyUSDC 交易对，依据市场需求实现封装代币和原生代币的转换。）这种方法与前两种方法最大的区别在于通过引入封装代币，使得跨链桥的目标链端与原生资产脱钩，将原生资产在一定程度上与跨链桥本身的安全性进行隔离。</p>\n<p><strong>（四）Wrapped + Mint/Burn（封装 + 铸造/销毁）</strong></p>\n<p>此类方法更进一步，在源区块链上将原生代币转换为封装代币，在跨链桥的铸造和销毁阶段均使用封装代币，而后将目标链的封装代币转换为原生代币。（例如将 1USDC 从以太坊跨链至 FTM，首先在以太坊上将 USDC 换为封装代币 anyUSDC，而后通过跨链桥将以太坊的 anyUSDC 跨链为 FTM 的 anyUSDC，最后提供 USDC-anyUSDC 交易对，得到 FTM 上的 USDC。）这种方式将跨链桥与跨链资产本身分离，降低了跨链桥的安全性问题对跨链资产价值的影响。</p>\n<p><strong>四、浅析桥技术</strong></p>\n<p>本部分聚焦于跨链桥技术本身，对于桥技术的分类有很多维度，有的根据实现目标将桥技术划分为针对特定资产的、针对特定区块链的、针对特定应用的以及通用的跨链桥技术；有的根据跨链 Token 管理方式将桥技术划分为托管的和非托管的；有的根据跨链桥共识机制将桥技术划分中心化的、POA、POS 和 MPC（Multi Party Computation）。不管是哪种分类维度，最核心的是跨链桥本身对跨链交易的验证，这也是保障跨链桥健壮性的核心设计组件，因此基于对交易的验证模式，对跨链桥技术进行如下分类，并结合当前项目进行举例：</p>\n<p><strong>（一）中心化的跨链网络</strong></p>\n<p>此类跨链技术往往与中心化交易所紧密相关，我们以币安交易所的 Binance Bridge 为例。Binance Bridge 已经开发至 V3 版本，目前基于币安交易所的币安链和币安智能链生态，支持币安链、币安智能链、以太坊、TRON、Solana 等公链上 60 多种主流资产的跨链，项目开发的初衷主要是围绕 BSC 和以太坊的资产跨链，确保 BSC 生态的蓬勃发展。近期币安交易所发布了 Token Canal 项目，该项目旨在通过在不同公链中发行锚定衍生资产，并为各类资产提供流动性，进而为币安链和币安智能链的用户提供一键跨链平台。</p>\n<p><strong>（二）Third Party Verification（第三方验证）</strong></p>\n<p>所谓第三方是指跨链桥验证交易的执行者为不同于项目方的第三方组织，其往往与跨链桥项目方为合作关系，为项目方选拔出的具备资质、值得信任的跨链桥网络安全维护者。在此类验证模式中，这些第三方验证者会对用户发起的跨链交易进行最终性和安全性确认，达成共识后，用户就会在目标链上接收到跨链资产。理论上而言，第三方验证者的数量越多，跨链桥的运行就越去中心化，但在实际中，此类跨链桥运作模式往往是偏向中心化的，因此跨链桥运作的安全与否很大程度上决定于项目方本身的技术实力和对合作方的遴选能力。为进一步约束第三方验证者的行为，部分跨链桥网络会对验证者实施保证金质押制度，一旦验证者履职不足或作恶，将通过扣除保证金的方式补偿跨链网络。</p>\n<p>使用类似本类跨链桥技术的项目案例有：</p>\n<p><strong>1. WBTC</strong></p>\n<p>全称 Wrapped BTC，是一种锚定 BTC 的 ERC20 代币，通过将 BTC 网络中的 BTC 跨链至以太坊，从而实现 BTC 价值的进一步赋能，增强其流动性，由于每个 WBTC 都 1:1 与 BTC 进行锚定，因此其价值本身与 BTC 等同。跨链机制由两类角色参与，托管商和做市商，托管商负责托管用户锁定的 BTC 以及依据做市商的铸造请求最终执行 WBTC 的铸造并支付给做市商，做市商负责与用户交互，接收用户支付的 BTC 并托管给托管商，以及发起铸造请求并将铸造后的 WBTC 支付给用户。对做市商和托管商的管理是基于 DAO 的概念，依据多方参与共识进行增减。</p>\n<p><strong>2. WormHole</strong></p>\n<p>Wormhole 是近期比较火的 Solana 公链的官方跨链平台，主要用来实现以太坊和 Solana 资产之间的双向转换。此类官方跨链平台主要是服务于自身公链生态的拓展，引流外部资金而开发的，通过以太坊 ERC20 标准和 Solana SPL 标准的跨链转换，为用户提供便捷的跨链体验。Wormhole 的跨链网络是由 19 个独立的验证人进行维护，19 个验证人形成的共识，确保跨链协议的安全性。</p>\n<p><strong>3. Avalanche Bridge</strong></p>\n<p>AvalancheBridge 也是一款官方跨链桥，用于将 ERC20 标准的资产与 AvalancheBridge 的 Subnet——Contract 链进行跨链互通，但该跨链桥功能有限，仅支持 ERC20 代币，不支持 BTC、ETH 等原生代币资产。在该跨链桥中，会有名为 warden 的第三方独立验证人对跨链交易进行验证，只有 3/4 以上的验证人达成共识才可成行。</p>\n<p><strong>4. Anyswap</strong></p>\n<p>Anyswap 是一个专门化的去中心化跨链交换协议，目前已运行在多个主流平台，支持以太坊、BSC、Fusion、Fantom 等多个区块链的资产跨链，也支持 L2 解决方案，Anyswap 平台的稳定性和去中心化性由 Any 代币的持有者选出的 Anyswap 工作节点支持，其使用基于 SMPC 安全多方计算 +TSS 门限签名技术，使其可以覆盖几乎全部种类数字资产。</p>\n<p>除了以上项目之外，还有 Matic、Synapse、Thorchain、Qredo、Ronin 等项目均采用此类跨链桥技术。</p>\n<p><strong>（三）Smart Contract/Light client（去中心化验证）</strong></p>\n<p>去中心化验证模式也叫原生验证，就是通过源链上的消息进行监控，然后将加密证明和区块头转发到目标链上的智能合约，验证后在目标链上执行操作，这是一种无须信任的模式，同时由于验证传递的信息较多，因此存在验证本身费用较高，速度相对较慢的问题。</p>\n<p><strong>1. Terra Bridge</strong></p>\n<p>Terra Bridge 是 Terra（LUNA）提供的官方跨链桥，主要作用是将 Terra 生态中的代币资产跨链至 BSC、以太坊等网络，目前支持 Terra 生态内的 LUNA、UST 以及合成资产代币 mToken 跨链。该跨链桥基于在 Terra 和以太坊两侧部署的 Shuttle 合约，仅在从 Terra 到以太坊进行代币跨链时才收取跨链中继费用。</p>\n<p><strong>2. Near RainbowBridge</strong></p>\n<p>RainbowBridge 是 Near 官方推出的跨链桥，主要用于对接以太坊上的资产，仅支持 ERC20 资产的跨链。Near 彩虹是一个无须许可、无须信任的自动化协议，它通过在以太坊和 Near 链上部署智能合约（轻客户端），实现 Near 和以太坊上的信息互通，包括能够识别状态以及制定信息回调安排。</p>\n<p><strong>3. IBC</strong></p>\n<p>全称 Inter-Blockchain Communication，是 Cosmos 推出的通用跨链信息传输协议，可以让信息和资产跨链更去中心化。源链上 IBC 模块会不断同步目标链上的区块头信息，同时目标链上的 IBC 模块也一样，双方能够实现跟踪对方区块链上的验证者集合变化，本质上就是互相维护了一个对方的轻节点。</p>\n<p><strong>4. BTC Relay</strong></p>\n<p>BTC Relay 是区块链系统中的第一条侧链，最初用来解决 BTC 的流动性问题。其是部署在以太坊上的智能合约，该合约保存了比特币区块链的区块头信息，BTC Relay 使用这些信息构建类似 BTC SPV 轻客户端使用的 BTC 迷你链，来使得以太坊上的智能合约能够验证 BTC 区块链上的交易，简而言之，就是用户可以通过使用 BTC Relay，支付 BTC 来使用以太坊上的 Dapp，整个过程是去中心化的。</p>\n<p>除了以上项目之外，还有波卡 SnowBridge、LayerZero、Movr、Optics、Gravity Bridge 等项目均采用此类跨链桥技术。</p>\n<p><strong>（四）Peer to Peer（流动性网络）</strong></p>\n<p>流动性网络是基于节点的点对点网络，是一种局部认证的方式，每个节点本身就是路由器，提供目标链的原生资产而非封装资产，用户通过与局部节点/验证人角色进行交互而进行跨链。</p>\n<p><strong>1. Hop</strong></p>\n<p>Hop Bridge 是一个通用的跨 Rollup 和 L1 的跨链桥，支持以太坊 Arbitrum 和 Optimism 方案，侧链 Matic 以及以太坊间的转账。Hop Bridge 借用了销毁/铸造代币的模式，并在源链和目标链两端加上了两个 AMM 流动性池，用户的跨链手续费用于支付给流动性池 LP 提供者。此类跨链资产安排就是我们在第三部分中提到的 Wrapped + Mint/Burn 方法。在以上过程中有两个重要角色，Bonder 和 LP，Bonder 是有白名单的节点，需要抵押资产来铸造两个 AMM 流动性池中使用到的封装资产 htoken,LP 为链上的 AMM 提供流动性并获得收益。</p>\n<p><strong>2. Celer</strong></p>\n<p>Celer 是一个高性能的 Layer2 拓展性平台，具备跨多链、跨 L2 的特性，CBridge 是 Celer 推出的跨链桥，旨在支持不同的 L1 公链、不同的 Rollup 解决方案（Arbitum）和侧链（Matic）。CBridge 的跨链过程不涉及代币的铸造和销毁过程，Celer 通过构建状态通道并在通道上进行原子交换来实现资产转移，整个过程的安全性由 SGN 保障，SGN 是一个专门的 POS 区块链，用于监控与 L2 状态相关的 L1 交易，并信息从 L2 传递回 L1。具体来说，用户在源区块链上进行资产锁定后，CBridge 会在源链和目标链上创建一个状态通道，用户的交易对手方是 relay node，relay node 会在目标链上创建安全合约，用于用户对目标链上的跨链后资产进行 claim。Relay node 在不同链上都有丰富的流动性，确保用户能够顺畅的进行资产跨链。</p>\n<p><strong>3. Connext</strong></p>\n<p>Connext 也是一个以太坊的 L2 互操作协议，其在资产跨链的基础上将功能拓展到了跨链数据调用，理论上其可以支持所有 EVM 兼容的链。其跨链桥与 Celer 相似，通过在支持的链上构建流动性池，利用状态通道实现原子交换。在跨链信息传递方面，Celer 使用 SGN（外部验证者）来验证跨链数据安全，而 Connext 部署 NXTP 实现跨链信息的内部验证。跨链过程中会涉及 Router 和 Relayer 的角色，Router 与 celer 的 relay node 角色相似，用户提出跨链请求后由 Router 进行竞价，而后将交易进行跨链传递，Relayer 负责跨链信息的内部验证，Router 和 Relayer 共同确认后用户可以获得跨链后资产。</p>\n<p><strong>五、结语</strong></p>\n<p>虽然跨链桥技术蓬勃发展，但目前仍有很多问题亟待解决，比如跨链桥跨链普遍用时过长的问题、比如 NFT 跨链的实现问题、比如跨链解决方案成本过高的问题等等。对于跨链桥技术优劣的区分，没有绝对的标准，随着场景和用户的转变，对跨链桥技术的使用偏好也发生着变化，但究其核心，安全才是第一位的。随着区块链技术的蓬勃发展，即使经过安全机构审计的合约代码，也存在被攻击的可能。未来的区块链世界必然是万链互联的，基于特定公链的官方跨链桥百花齐放，中心化交易所的高效跨链设施也必将占有一席之地，波卡、Cosmos 提出的同质化区块链跨链平台也将靴子落地，跨链桥将成为区块链网络潮席卷全球的重要武器，不可或缺。</p>\n","raw":null,"categories":[],"tags":[]},{"title":"技术解读：深入了解达尔文跨链桥","slug":"技术解读：深入了解达尔文跨链桥","date":"2021-12-23T03:20:36.000Z","updated":"2021-12-23T03:20:36.209Z","comments":true,"path":"api/articles/技术解读：深入了解达尔文跨链桥.json","excerpt":"最近仔细阅读了 Darwinia Medium 博客的四篇关于其跨链桥的说明文章，恰逢近期对跨链桥技术颇感兴趣，现将上述文章核心内容整理说明如下，本文为笔者个人的解读，仅供社区参考。本文约 60...","keywords":["blockchain","crypto","darwinia","dcep","meta","socialfi","xcarnival"],"cover":"https://ipfs.fleek.co/ipfs/QmSRMmDyZbTkypXdy9EPfC4o4fBA8ExCRsWz8dcpz7UrZy","content":"<p>最近仔细阅读了 Darwinia Medium 博客的四篇关于其跨链桥的说明文章，恰逢近期对跨链桥技术颇感兴趣，现将上述文章核心内容整理说明如下，本文为笔者个人的解读，仅供社区参考。本文约 6000 字，请耐心阅读，定不负时光。</p>\n<p><strong>参考内容：</strong></p>\n<ol>\n<li>[Understanding Darwinia Bridge 1-1] Darwinia Relayer Incentive Scheme—Fee Market.</li>\n<li>[Understanding Darwinia Bridge 1-2] Mapping Token Factory.</li>\n<li>[Understanding Darwinia Bridge 1-3] The Token Bridge Solution.</li>\n<li>[Understanding Darwinia Bridge 1-4] The New Message Protocol for the Ethereum-Darwinia Bridge.</li>\n<li>Fee Market Strategy and Design of Relayer Fee Market details from darwinia’s Github.</li>\n</ol>\n<p><strong>整体思路：</strong></p>\n<p>依据上述文章内容，为更好的、成体系的阐述所有内容，笔者对行文内容进行了编排，打乱了参考文章的顺序。首先我们从 Darwinia 提供的资产跨链解决方案展开（1-3）介绍，之后阐述一下该方案中 Issuing 模块下面的子模块映射代币工厂（1-2）。而后我们深入研究一下资产跨链解决方案中的信息传递环节，即 darwinia 提出的 Ethereum-Darwinia 跨链通讯协议（1-4），最后聚焦通讯协议中的核心角色 Relayer，阐述一下市场化的跨链费用报价过程（1-1）。下面，我们开始。</p>\n<p>一、<strong>The Token Bridge Solution（资产跨链解决方案）</strong></p>\n<p>目前最常用的达尔文跨链桥是达尔文和以太坊之间的双向跨链桥，达尔文是基于 Substrate 开发的区块链，因此达尔文和以太坊两者是异构的。本部分阐述的就是达尔文提出的用于异构区块链之间的资产跨链解决方案。</p>\n<ol>\n<li><strong>CBA model</strong></li>\n</ol>\n<p>达尔文桥基于 CBA（Cryptocurrency Backed Asset）model 设计，该模型下有两个核心模块，即源链上 Backing module 和目标链上的 Issuing module。</p>\n<p><strong>Backing module：</strong> 用于锁定和解锁源区块链上的原生资产。</p>\n<p><strong>Issuing module：</strong> 用于发行和销毁目标链上的映射资产，这种价值由源链上的原生资产背书的映射资产，就是上文中提到的 CBA。</p>\n<p>这种 CBA 模型在跨链桥的设计中是最常见的一种类型。其具体实现方式如下：</p>\n<p>（1）<strong>Deploy&amp;Register 部署与注册</strong></p>\n<p>如下图所示：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmSRMmDyZbTkypXdy9EPfC4o4fBA8ExCRsWz8dcpz7UrZy\" alt=\"df802af7-9bf2-4bbb-bcec-eea04badfa45\"></p>\n<p>桥创建者在源链上部署 Backing 的智能合约（Backing module）,同时在目标链上部署 Issuing 的智能合约（Issuing module）。跨链桥的使用者可以调动 Backing module 的接口来注册源链上的原始资产，之后 Relayer（中继者）将会把信息同步到目标链的 Issuing 合约，该合约会创建一个映射合约，后续来发行和存储映射的资产。关于 Relayer 的话题，我们会在后面部分详细说明。</p>\n<p>（2）<strong>Issue 发行</strong></p>\n<p>如下图所示：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmdFqTXBo5rj6X4gq6cua8G2U7zmq89DEb9LkpjihEkyr7\" alt=\"79b9584f-e786-48f0-90db-f168be945f35\"></p>\n<p>用户在源链上锁定一定数量的原生代币并发起代币跨链申请（通过调用 Backing module 的 lock_and_remote_issue()接口），代币锁定后用户可以获得锁定的证明，relayer 将此证明发送至目标链上的 Issuing module 进行验证，验证成功后 Issuing module 依据合约规定将对应数量的映射资产发送至目标链上的收款账户。</p>\n<p>（3）<strong>Transfer/Swap 转账与兑换</strong></p>\n<p>如下图所示：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmWPUxSsUWJaQ5RRSFpU2TzPyjaMSxzds2Zgg3kHhgkaji\" alt=\"f0d088be-dd92-44a9-bb90-f6117fd47c03\"></p>\n<p>映射代币其本质也是一种代币，因此其也可以作为一种资产在不同用户之间转移，同时可以通过在 dex 上设置流动性交易对与其他代币进行兑换。</p>\n<p>（4）<strong>Redeem 赎回</strong></p>\n<p>如下图所示：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmZYkRTsBCfDNmUVjhowK2SaSLTKDPQi6hJiars2KWfYvc\" alt=\"736ecffb-a712-4148-8a9f-0e83274d9f59\"></p>\n<p>用户可以在目标链上通过销毁映射代币的方式来解锁源链上锁定的代币（通过调动目标链上 Issuing module 的 remote_unlock()接口），relayer 将销毁映射代币的证明中继至源链上的 Backing module，Backing module 在验证该证明后解锁原生代币。</p>\n<ol start=\"2\">\n<li><strong>Backing Technology 去中心化的资产背书技术</strong></li>\n</ol>\n<p>常见的资产背书技术实现方式主要有以下三种，这里用比较宏观的方式来说明，想研究技术细节还需要去看对应项目的 docs，由于不是本文重点，就不展开说了。</p>\n<p>（1） <strong>多节点验证：</strong> 通过设置多个信任节点或者托管人对用户锁定的原生资产进行集体托管，往往通过多签或者至少占比多少的节点签名等方式来避免单节点模式下的单点失效，去中心化程度依据参与验证节点数量的多少决定。参考 Parity Bridge, ChainX。</p>\n<p>（2） <strong>桥资产质押与 Chain Relay 结合：</strong> 参考 XClaim 项目的方式，但是该方案仅仅适用于同质化、高流动性的资产，并且其经济模型可行性相对较弱。</p>\n<p>（3） <strong>完全使用 Chain Relay（链中继）：</strong> 达尔文跨链桥就是此种方式，完全使用 Chain Relay 进行链上验证。这种解决方案要求部署 Issuing module 的目标链必须支持智能合约、链上 runtime、硬分叉等特性，因此在链中继和类似 Bitcoin 的区块链是无法部署的。这种模式的优势是能够支持多样化的原生资产，包括非流动性资产和 NFT。经济模型而言，类似达尔文的 Sub-linear 亚线性链中继会有更好的表现。</p>\n<p><strong>二、Mapping Token Factory（映射代币工厂）</strong></p>\n<p>本部分我们针对前文提到的，目标链上 Issuing module 的其中一个子模块 Mapping Token Factory 进行实现细节的阐述，该模块主要用于在目标链上创造、发行和销毁映射资产。</p>\n<ol>\n<li><strong>Mapping Assets 映射资产</strong></li>\n</ol>\n<p>这里的 Mapping Assets 主要强调与源链上 native Assets 原生资产的一一映射，在很多场景中也可以叫做 Wrapped Assets/Wrapped Tokens，本质都是一样的，都是由原生资产背书的衍生资产，是跨链场景中常见的技术安排。在映射资产创建之前，Mapping Token Factory（映射代币工厂）为创建映射资产设定了一系列的准则，最终目的都是使映射资产与原生资产保持同样的特性和方法（具体体现在代币的智能合约中），当然，允许存在不同，也允许后续的优化升级。</p>\n<p>在提取链上元数据时，映射资产主要从两方面进行体现：</p>\n<p><strong>Symbol prefix:</strong>  <strong>”</strong>  <strong>x</strong>  <strong>”</strong>  <strong>:</strong> 在元数据中，Mapping Token 标志的前缀会多一个 x，举例来说，如果原生资产为 RING，那么映射资产就为 xRING，如果 xRING 再次被映射，则映射后的资产名称为 xxRING。</p>\n<p><strong>Name postfix：</strong>  <strong>”[${backing_chain_short_name}&gt;”</strong>  <strong>:</strong> 还是举将 RING 从 Darwinia 主网向其测试网 Crab 进行跨链，RING 的全称叫做 Darwinia Network Native Token，则 Crab 上跨链后的资产名称就为 Darwinia Network Native Token[Darwinia&gt;，如果该资产又跨链至其他区块链网络，则新网络上的资产名称为 Darwinia Network Native Token[Darwinia&gt;[Crab&gt;。下图展示了以 USDT 进行跨链的类似流程：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmXVHS8uaZhEvedyYLJYfh6etHFJH2y4BWM73Ecf6XY8MU\" alt=\"5073ad4e-55f8-4c07-a143-51b348be5196\"></p>\n<ol start=\"2\">\n<li><strong>Permission Management 许可管理</strong></li>\n</ol>\n<p>进行资产的发行许可不是由单个私钥进行控制的，而是由系统账户进行控制，只有在源链上的 backing module 锁定了原生资产以后，才可以激活目标链上的发行许可，一旦映射资产发行至收款人的账户，收款人对该资产就拥有了完全控制权。对应的，在解锁的流程中，只有在目标链上进行了映射资产的销毁，才能够获取源链上的原生资产的解锁许可，这种机制确保的映射资产和原生资产的一一背书和映射关系，实质上来讲，映射资产的转移与原生资产的转移，在价值上，是对等的。</p>\n<ol start=\"3\">\n<li><strong>Safety of Assets 资产安全</strong></li>\n</ol>\n<p>一旦在两个区块链中为某种资产 Token 建立了跨链桥，这个桥就拥有了独立的安全性，也就是说，不同资产之间的跨链桥是相互独立的，单个资产桥的安全问题不会影响其他桥。</p>\n<p><strong>三、The Message Protocol for the Ethereum-Darwinia Bridge（以太坊-达尔文桥的信息跨链协议）</strong></p>\n<p>IT 技术的本质是信息的传递，而跨链技术的核心就是跨链信息的传递和确认，在从代币的角度了解了达尔文跨链桥的宏观架构后，我们聚焦跨链过程中信息中继和传递的过程，the Message Protocol，为便于细节讲解，后文基于已经实现并落地的达尔文 Ethereum-Darwinia 跨链桥进行阐述，可参考下图：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmZ5wfR3yRZBTtpb7b8yebvDJRi1JwMZ7mA7F3TwWzqfz6\" alt=\"ca986f86-975a-4bf9-b050-500a84fc1ea0\"></p>\n<ol>\n<li><strong>相关概念</strong></li>\n</ol>\n<p><strong>（1）Message 信息：</strong> 所谓信息跨链本质上是指从源链上发送带有参数的跨链指令，调用目标链上智能合约的功能函数。简单来讲，就是用户向跨链桥发起跨链指令，该指令中含有用户需要进行跨链的 token，数量等参数信息，该信息被处理并中继至目标链的智能合约，调用智能合约代码中的功能函数。这个过程类似于一个 RPC 调用，而 message 中往往含有源链、目标链、指令内容等数据。</p>\n<p>（2） <strong>Channel 通道：</strong> 通道是单向的，负责将信息从源链发送至目标链，包括源链上的 outbound lane（出站通道）和目标链的 inbound lane（入站通道）两种，当然，在实现双向跨链的情况下，两个区块链上两种通道都是有的。如上图，在 Darwinia 跨链桥的三层设计中，用户想要实现跨链就必须将信息通过 Message Layer 信息层的通道进行传输，信息层含有多个这样的出入站通道，并且并对传输信息有一定的保护和筛选机制。</p>\n<p>（3） <strong>Relayer 中继：</strong> 中继是信息传输搬运工的角色，负责将信息在源链和目标链之间传递，与区块链上的智能合约不同，它是一个链下的角色，是达尔文跨链桥的重要组成部分。</p>\n<ol start=\"2\">\n<li><strong>Message Workflow 信息流</strong></li>\n</ol>\n<p>信息传输协议可以通过链上智能合约或者 runtime 中的一个模块实现，目前达尔文网络已经实现了 DVM 虚拟机（对以太坊智能合约兼容），因此 Darwinia 在以太坊和达尔文网络两边都通过智能合约部署了信息传输协议。</p>\n<p><strong>（1）Data Structure of Message 信息流的数据结构</strong></p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmPp1VyPb5ofMW6SAGkdGtG3gYLUmVNS4iFcsVEq1RLNeM\" alt=\"2a24d98b-034d-4eb1-8318-58e76b334e5f\"></p>\n<p>如上图所示，</p>\n<p>Message 是由源链上的智能合约产生，被发送至目标链上的智能合约并被执行。其包括 MessageKey 和 MessageData 两部分，其中 MessageKey 包括源链、目标链和出入站通道 ID；MessageData 代表了用户想要对目标链上智能合约进行的操作指令，包括指令内容 payload（发起账户地址、目标合约地址及具体指令参数）和跨链费用信息 fee。理论上 payload 中包含的指令数据信息没有限制，而且可以被目标链上的智能合约解码读取并执行，在设计上达尔文使用 ABI 编码方式，因为它易于生成且 gas fee 低。</p>\n<p><strong>（2）Process of a message delivery 信息传递的完整生命周期</strong></p>\n<p>完整生命周期如下图所示（请放大图片观看，以信息从以太坊跨链至达尔文网络为例）：</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmNfahutLz1hdazGMMmoAN9abEjptLR1opnE2q9m1dGFMH\" alt=\"41696cf9-a771-44e9-8dc1-63a16e61501a\"></p>\n<p>首先，以太坊的用户发送指令消息来调用达尔文网络上智能合约的功能函数（通过调用 outbound lane 出站通道的 send_message()），就像前文中提到的，该信息包括通道的 ID、用户愿意支付的跨链费用信息等数据。</p>\n<p><strong>Phase1 第一阶段（Delivery Phase）：</strong></p>\n<p><strong>#1 保存信息并触发 MessageAccepted 事件：</strong> 以太坊上指定的出站通道会检查并保存信息，并且触发“信息已接收”的事件，如果该信息通过了检查，会被配发一个 nonce 并保存在智能合约中，到这一步，信息就处于“被跨链桥接收”的状态。</p>\n<p><strong>#2 获取存储/信息证明：</strong> 一旦 relayer 发现了处于被接收状态的信息，就会要求获取相关证明（receipt_proof 或者 storage_proof）。</p>\n<p><strong>#3 接收信息证明 &amp; #4 验证信息证明：</strong> relayer 接收了相关证明后，就会通过调用达尔文网络上特定 inbound lane 入站通道的 receive_message_proof()功能来转发信息和相关证明，同时由运行在达尔文网络上的以太坊轻客户端（所谓轻客户端是与完整客户端相对应的，相较完整客户端完全存储以太坊的区块链信息，轻客户端仅仅存储以太坊区块头信息以确保信息进行验证，轻客户端往往背后会依赖于完整的客户端以确保万一需要对完整信息进行核验）对信息的证明进行验证（通过调用 verify_message_proof()功能）。</p>\n<p><strong>#5 接收信息并发送信息 &amp; #6 保存传递的信息并触发 MessageDispatched 事件：</strong> 以太坊轻客户端验证完信息后，入站通道会继续转发信息并触发“消息已发送”事件，至此，消息已被转发至目标链并处于“被跨链桥送达”的状态，虽然消息已经被送达，但目标链并不知道这个情况，因此需要进入信息跨链的第二阶段，relayer 需要把达尔文网络上的信息传递情况通知以太坊侧。</p>\n<p><strong>Phase2 第二阶段（Confirmation Phase）：</strong></p>\n<p>进行第二阶段 Confirmation 的信息传递主要出于以下两方面的考虑：一是通过该阶段流程的开展，可以对完成对已经 delivered 但尚未 confirmed 的信息进行流量控制；二是如果部署了 Relayer Fee Market（后文会提到），relayer 需要证明他们确实完成了信息的传递并获取对应奖励。</p>\n<p><strong>#7 获取存储/信息证明、#8 接收信息传递证明、#9 验证信息传递证明、#10 确认信息传递：</strong> 与第一阶段的流程类似，以太坊上部署的达尔文轻客户端会对 relayer 提交过来的第一阶段工作证明进行验证，之后以太坊上的入站通道就会触发第二阶段的“消息已被跨链桥送达”事件，至此，信息传递已最终被跨链桥两侧确认。</p>\n<p><strong>#11 触发 MessageDelivered 事件并支付 relayer 奖励：</strong> 之后就会触发 relayer 获取奖励的流程也是支付跨链费的过程。</p>\n<p><strong>#12 获取存储/信息证明 &amp; #13 接收信息证明：</strong> 最后 relayer 会通知达尔文链信息传递已经被最终确认，可以进行后面其他信息的跨链操作，没有这最后一步，达尔文链上的所有跨链信息都会排队堆积在入站通道，而无法被转发。</p>\n<ol start=\"3\">\n<li><strong>Relayer Incentive Scheme 中继激励机制</strong></li>\n</ol>\n<p>目前 relayer 节点是由达尔文项目自己运行的，以确保跨链桥的有效运行，同时达尔文也设计了一套名为 Relayer Fee Market 的 Relayer 激励机制，以确保未来通过更为去中心化的形式实现跨链桥并吸引更多参与者来建设社区。</p>\n<p><strong>四、Darwinia Relayer Incentive Scheme—Fee Market（达尔文中继的激励框架—跨链费市场）</strong></p>\n<p>最后我们聚焦于跨链桥的最重要角色 Relayer（中继），阐述一下达尔文设计的一个集中竞价的跨链费价格决定机制，Relayer Fee Market。</p>\n<ol>\n<li><strong>前提条件</strong></li>\n</ol>\n<p>（1）仅支持源链的原生代币作为作为跨链费的支付方式。</p>\n<p>（2）跨链费的计算由源链上的定价系统决定，该定价系统是由 Relayer Fee Market 实现的。</p>\n<p>（3）目标链上的所有交易成本均由 relayer 承担，relayer 通过出示其成功传递消息的证明获取跨链处理费用，为了确保激励机制可行，定价机制应当确保 relayer 获取的跨链费用收益高于其成本，如果自动化的定价市场出现问题，relayer 应当可以手工出价，一旦 relayer 没有如期传递消息，他们应当被惩罚。</p>\n<p>（4）在 Relayer Fee Market 市场上，relayers 和用户是供需的双方，因此跨链费的高低随着供需双方的多寡而波动，同时任何人都可以承担 relayer 的角色，一旦成为 relayer，就必须承担对应的风险，这些风险包括代币价格波动、报价和获取收益的时滞、操作失败后惩罚导致的押金损失等。</p>\n<ol start=\"2\">\n<li><strong>Tiered Quotation Market 分层报价市场</strong></li>\n</ol>\n<p>分层报价市场适用于源链上 gas 费较低且交易确认速度比较快的链，例如 Heco、BSC、Polygon 和 Darwinia，其具体报价流程如下：</p>\n<p>首先会有一个链下的定价系统来发布价格参考信息，relayers 依据系统提供的参考价格信息提出自己的报价，同时需要在链上锁定一定数量的保证金做抵押以防止失败和作恶的情形。在有意向的 relayers 都提出报价后，系统会对价格进行升序排序并选出最低的 n 个报价，我们假设是最低报价为 Relayer1（简称 R1）提出的价格 P1，次低为 R2 提出的 P2，依次类推直至 Rn 提出的 Pn，这 n 个被选出的 Relayers 都叫做 Assigned Relayer，而用户在本次市场中实际支付的跨链费为 Pn，之所以一次选择 n 个 Relayer 出来，是出于备份冗余的考虑。这 n 个被选出来的 Assigned Relayers 实际上集体为本次的信息跨链负责，跨链成功，他们会拿走多数的奖励，也会因为失败而被严厉惩罚。依据自己报价的高低每个 Assigned Relayer 都会被分配一个 time slot，出价越低 time slot 的优先级越高，信息跨链就越可能在自己的 time slot 被传递和确认。同时系统会确保有足量的 Assigned Relayer 才会执行信息跨链，如果参与的 Assigned Relayer 低于系统要求的 MIN_ASSIGNED_RELAYERS_NUMBER，系统会自动拒绝用户跨链请求。</p>\n<p>这里我们要聚焦一下 Assigned Relayer、Delivery Relayer 和 Confirmation Relayer 的区别，因为最终的跨链费奖励会流向他们（下一部分阐述）。笔者在阅读原文过程中一开始对这三个概念有些混淆，在反复阅读原文并咨询 Darwinia Dev 后，进一步理解阐述如下：</p>\n<p><strong>Assigned Relayer：</strong> 如前文所言 Assigned Relayers 要质押保证金在链上，集体为本次的信息跨链负责，是可能被惩罚的，但只要正常履职，会拿走多数奖励。</p>\n<p><strong>Delivery Relayer：</strong> 是执行本文第三部分中提到的 Delivery Phase 过程的 Relayer，可以是 Assigned Relayer，也可以是报价未被选中的 Relayer，实际上成为 Relayer 的门槛不高，只要机器运行 darwinia Bridger 客户端即可，也不是必须要进行保证金抵押。</p>\n<p><strong>Confirmation Relayer：</strong> 是执行本文第三部分中提到的 Confirmation Phase 过程的 Relayer，同样的，也可以是 Assigned Relayer 或者是其他 Relayer，对是否质押保证金也没有要求。Confirmation Relayer 和 Delivery Relayer 可以不是同一个。</p>\n<ol start=\"3\">\n<li><strong>Details of Implementation 详细的实现过程</strong></li>\n</ol>\n<p>（1） <strong>Relayer 注册和锁定保证金：</strong> 调用 enroll_and_lock_collateral 实现，可以调用 cancel_enrollment 退出，但值得注意的是，一旦 Relayer 被选作了单个信息跨链过程的 Assigned Relayer，在跨链过程结束前是无法退出的，因为其可能会被 slash 掉保证金。</p>\n<p>（2） <strong>报价：</strong> 目前使用较为简单的报价方式，即 fn(message)=const_price * 1，即每条消息的固定价格是多少，后续会对 fn(message)报价方式进行更市场化的开发。如果 Relayer 在注册后保证金由于被罚款而导致不足，那么其在补足保证金前将无法在成为 Assigned Relayer。</p>\n<p>（3） <strong>发送信息：</strong> 用户支付 Pn 跨链费来进行跨链，Pn 的分配会通过 relayer fund account 模块开展。</p>\n<p>（4） <strong>信息传递：</strong> Delivery Phase 和 Confirmation Phase 过程，具体可参考第三部分。</p>\n<p>（5**）奖励或者惩罚 Relayer：**</p>\n<p><img src=\"https://ipfs.fleek.co/ipfs/QmbqKUewSq7PqMi9SLHWiMEUtFMMJQT8SrUAUp69qy5mNx\" alt=\"4e8bd595-2728-49fb-bf08-d0900cc762cb\"></p>\n<p>上图展示了用户支付的跨链费 Pn 的分配过程，以及一旦在所有 Assigned Relayers 的 time slot 中均跨链失败后 Assigned Relayer 被集体惩罚的过程：</p>\n<p>**a. **虽然用户实际支付了 Pn 的跨链费用，但实际只有 Assigned Relayers 中的最低报价 P1 被支付给了各个 Relayer，中间的差值 Pn-P1 直接上缴国库。在 P1 的分配上，如果用户的信息跨链最终在 Relayer n 的 time slot 中被确认，那么 Rn 就会得到 60%P1 的奖励，Message Delivery Relayer 可以得到 80%（1-60%）P1 的奖励，Confirmation Relayer 得到剩下 20%（1-60%）P1 的奖励。</p>\n<p><strong>b.</strong> 一旦在所有 Assigned Relayers 的 time slot 中均跨链失败后，用户的跨链信息依然会被跨链并经过 Delivery 和 Confirmation 的过程，此时 Message Delivery Relayer 和 Confirmation Relayer 会按照 8:2 的比例分享全部的跨链奖励 S(t)（S(t)&gt;Pn），而这个跨链奖励 S(t)来自于对所有 Assigned Relayer 锁定的保证金罚款而来。</p>\n<p>**c. **我们可以将跨链费的分配看做是一个 order+auction 的市场，Assigned Relayer 们所在的是 order 订单市场，他们需要在合理的时间内实现信息的跨链（即在所有 Assigned Relayer 的 time slot 跑完之前完成跨链，否则就会被 slash），一旦在有限时间内未实现跨链，则该订单进入拍卖市场由大家竞争参与 S(t)的争夺，当然在拍卖市场中之前的 Assigned Relayer 也可以进来参与争夺，以对冲之前被 slash 的损失。</p>\n<p>除了介绍上文提到的跨链费报价市场外，原文还提出了预言机 + 链上自动定价的替代机制，也提到了专门针对与 non-Substrate 区块链进行跨链的 BEEFY 协议，它可以看做是 GRANDPA Finality 协议的可选组件，有兴趣的读者可以自行深入研究。</p>\n<p>以上。</p>\n","raw":null,"categories":[],"tags":[]}]}